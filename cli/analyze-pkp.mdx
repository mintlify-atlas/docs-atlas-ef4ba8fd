---
title: analyze-pkp
description: Analyze the size breakdown of a PKP file
---

The `analyze-pkp` command provides detailed insights into the size and structure of a ProveKit Prover (PKP) file.

## Command Syntax

```bash
provekit-cli analyze-pkp <pkp_path>
```

## Arguments

<ParamField path="pkp_path" type="string" required>
  Path to the PKP file to analyze (`.pkp` file generated by `prepare`)
</ParamField>

## Examples

### Basic Usage

Analyze a PKP file:

```bash
provekit-cli analyze-pkp noir_proof_scheme.pkp
```

### Example Output

```
PKP Size Analysis:
==================

Component breakdown (uncompressed Postcard):
  Program (ACIR):                2,456 bytes ( 15.2%)
  R1CS:                          8,734 bytes ( 54.1%)
  SplitWitnessBuilders:          2,891 bytes ( 17.9%)
  NoirWitnessGenerator:          1,234 bytes (  7.6%)
  WhirR1CSScheme:                  823 bytes (  5.1%)
  ------------------------------------------
  Total:                        16,138 bytes

R1CS breakdown:
  Interner:                      1,245 bytes ( 14.3% of R1CS)
  Matrix A:                      2,456 bytes ( 28.1% of R1CS)
  Matrix B:                      2,567 bytes ( 29.4% of R1CS)
  Matrix C:                      2,466 bytes ( 28.2% of R1CS)

Delta encoding savings (column indices):
  Matrix A:                        456 bytes saved ( 15.7%)
  Matrix B:                        523 bytes saved ( 16.9%)
  Matrix C:                        487 bytes saved ( 16.5%)
  Total:                         1,466 bytes saved ( 16.4%)

SplitWitnessBuilders breakdown:
  W1 Layers:                     1,567 bytes ( 54.2% of SWB)
  W2 Layers:                     1,324 bytes ( 45.8% of SWB)

Circuit statistics:
  Constraints:                       1,234
  Witnesses:                           567
  Public inputs:                         4

Efficiency: 13.08 bytes/constraint (uncompressed)
```

## Output Sections

### Component Breakdown

Shows the size of each major component in the PKP file:

- **Program (ACIR)**: The original ACIR circuit representation
- **R1CS**: The R1CS constraint system (largest component)
- **SplitWitnessBuilders**: Data structures for efficient witness computation
- **NoirWitnessGenerator**: Maps Noir inputs to R1CS witnesses
- **WhirR1CSScheme**: WHIR proof system parameters

### R1CS Breakdown

Details the R1CS constraint system components:

- **Interner**: Variable name storage and deduplication
- **Matrix A, B, C**: The three constraint matrices (A·w ⊙ B·w = C·w)

### Delta Encoding Savings

Shows compression efficiency for matrix column indices:

- Delta encoding stores differences between consecutive values
- Higher savings indicate sparser matrices (more efficient)
- Typical savings: 10-30%

### SplitWitnessBuilders Breakdown

Shows witness computation layer sizes:

- **W1 Layers**: First witness split
- **W2 Layers**: Second witness split

### Circuit Statistics

Provides key circuit metrics:

- **Constraints**: Number of R1CS constraints
- **Witnesses**: Number of witness variables
- **Public inputs**: Number of public input fields

### Efficiency Metric

Bytes per constraint indicates PKP file efficiency:
- Lower is better (more compact representation)
- Typical range: 10-50 bytes/constraint
- Varies based on circuit structure

## Use Cases

### Understanding PKP Size

Identify which components contribute most to file size:

```bash
provekit-cli analyze-pkp large_circuit.pkp | grep "Component breakdown" -A 7
```

### Comparing Optimizations

Compare PKP files before and after optimization:

```bash
provekit-cli analyze-pkp circuit_v1.pkp > analysis_v1.txt
provekit-cli analyze-pkp circuit_v2.pkp > analysis_v2.txt
diff analysis_v1.txt analysis_v2.txt
```

### Estimating Storage Requirements

Check total PKP size for deployment planning:

```bash
provekit-cli analyze-pkp scheme.pkp | grep "Total:"
```

### Investigating Compression

Examine delta encoding effectiveness:

```bash
provekit-cli analyze-pkp scheme.pkp | grep -A 5 "Delta encoding"
```

## Understanding PKP Components

### Program (ACIR)

The original ACIR circuit:
- Contains opcode definitions
- Includes black box function calls
- Typically 5-20% of total size

### R1CS

The largest component:
- Three sparse matrices (A, B, C)
- Variable interner for naming
- Typically 40-60% of total size
- Size grows with circuit complexity

### SplitWitnessBuilders

Optimized witness computation:
- Splits witness generation into layers
- Enables parallel computation
- Typically 10-25% of total size

### NoirWitnessGenerator

Bridges Noir and R1CS:
- Maps Noir variables to R1CS witnesses
- Handles ABI encoding/decoding
- Typically 5-15% of total size

### WhirR1CSScheme

Proof system parameters:
- WHIR-specific configuration
- Commitment parameters
- Typically 5-10% of total size

## Optimization Tips

<Note>
Based on the analysis output, you can:

1. **If R1CS is large**: Optimize your circuit to reduce constraints
2. **If delta encoding savings are low**: Circuit has dense matrices (harder to optimize)
3. **If Program (ACIR) is large**: Many complex operations (consider simplifying)
4. **If SplitWitnessBuilders is large**: Many witness variables (expected for complex circuits)
</Note>

## File Size vs. Compressed Size

<Warning>
The analysis shows **uncompressed Postcard sizes**. Actual PKP files on disk are compressed:

```bash
# Compare sizes
provekit-cli analyze-pkp scheme.pkp | grep "Total:"
ls -lh scheme.pkp
```

Compressed size is typically 20-40% of uncompressed size.
</Warning>

## Comparison with circuit_stats

Use both commands for complete analysis:

```bash
# Before preparation: analyze circuit
provekit-cli circuit_stats circuit.json

# After preparation: analyze PKP
provekit-cli prepare circuit.json
provekit-cli analyze-pkp noir_proof_scheme.pkp
```

- [`circuit_stats`](/cli/circuit-stats): Analyzes ACIR and R1CS structure
- `analyze-pkp`: Analyzes serialized PKP file size and efficiency

## Performance

The analyze-pkp command:
- Reads and deserializes the entire PKP file
- Performs size calculations via serialization
- Memory usage proportional to PKP size
- Fast operation (typically under 1 second)

## Source Reference

Implementation: `tooling/cli/src/cmd/analyze_pkp.rs`